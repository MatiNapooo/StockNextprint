<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Stock</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- HEADER -->
    <header class="top-bar">
        <div class="header-inner">
            <button type="button" class="btn-volver" onclick="window.history.back()">
                Volver
            </button>

            <nav class="menu-principal">
                {% if vista == "menu" %}
                    <!-- Menú principal: mismos colores, sin texto -->
                    <div class="menu-item inventario"></div>
                    <div class="menu-item entradas"></div>
                    <div class="menu-item salidas"></div>
                    <div class="menu-item pedidos"></div>
                {% else %}
                    <a href="{{ url_for('menu_principal') }}" class="menu-item menu">Menu</a>
                    <a href="{{ url_for('inventario') }}" class="menu-item admin">ADMIN</a>
                    <a href="{{ url_for('inventario_simple') }}" class="menu-item inventario">Inventario</a>
                    <a href="{{ url_for('entradas') }}" class="menu-item entradas">Entradas</a>
                    <a href="{{ url_for('salidas') }}" class="menu-item salidas">Salidas</a>
                    <a href="{{ url_for('pedidos') }}" class="menu-item pedidos">Pedidos</a>
                {% endif %}
            </nav>
        </div>
    </header>

    <!-- MAIN -->
<!-- MAIN -->
<main class="contenido {% if vista == 'menu' %}contenido-menu{% else %}contenido-app{% endif %}">



        {% if vista == "menu" %}
            <section class="acciones">
                <div class="acciones-container">
                    <a href="{{ url_for('inventario') }}" class="accion-card accion-card-menu">
                        <img src="{{ url_for('static', filename='img/insumos_menu.png') }}"
                            alt="Insumos"
                            class="accion-card-img">
                        <span>Insumos</span>
                    </a>
                    <a href="#" class="accion-card accion-card-menu accion-card-disabled">
                        <img src="{{ url_for('static', filename='img/papel_menu.png') }}"
                            alt="Papel"
                            class="accion-card-img">
                        <span>Papel</span>
                    </a>
                </div>
            </section>



        {# INVENTARIO #}
        {% elif vista == "inventario" %}
            <section class="historial historial-admin">
                    <div class="historial-header">
                        <div class="historial-header-left">
                            <h1 class="historial-titulo">Inventario</h1>
                            <div class="historial-filtro inventario-filtro">
                                <label for="filtro-inventario">Filtrar:</label>
                                <input id="filtro-inventario" type="text"
                                    placeholder="Escriba para filtrar">
                            </div>
                        </div>
                                    <div class="historial-header-right">
                                        <!-- Cerrar sesión -->
                                        <a href="{{ url_for('logout_admin') }}" class="btn-cerrar-sesion">
                                            Cerrar sesión
                                        </a>

                                        <!-- Botones de insumos -->
                                        <button type="button" class="btn-agregar-insumo">
                                            Agregar insumo
                                        </button>

                                        <button type="button"
                                                id="btn-eliminar-insumo-header"
                                                class="btn-eliminar-insumo"
                                                onclick="
                                                    document.getElementById('modal-insumo-eliminar').style.display='flex';
                                                    this.style.visibility='hidden';
                                                ">
                                            Eliminar insumo
                                        </button>

                                        <button type="button"
                                                class="btn-editar-insumo"
                                                onclick="document.getElementById('modal-insumo-editar').style.display='flex'">
                                            Modificar insumo
                                        </button>
                                    </div>

                    <div class="historial-tabla-wrapper">
                        <table class="historial-tabla" id="tabla-inventario">
                            <thead>
                                <tr>
                                    <th>CÓDIGO</th>
                                    <th>INSUMO</th>
                                    <th>DESCRIPCIÓN</th>
                                    <th>STOCK INICIAL</th>
                                    <th>ENTRADAS</th>
                                    <th>SALIDAS</th>
                                    <th>TOTAL</th>
                                    <th>ACCIÓN</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for r in registros %}
                                    <tr data-item-id="{{ r['id'] }}"
                                        data-codigo="{{ r['codigo'] }}"
                                        data-nombre="{{ r['nombre'] }}"
                                        data-descripcion="{{ r['descripcion'] }}"
                                        data-unidad="{{ r['unidad'] or '' }}">
                                        <td>{{ r['codigo'] }}</td>
                                        <td>{{ r['nombre'] }}</td>
                                        <td>{{ r['descripcion'] }}</td>
                                        <td>{{ r['stock_inicial'] }}</td>
                                        <td>{{ r['entradas'] }}</td>
                                        <td>{{ r['salidas'] }}</td>
                                        <td>{{ r['total'] }}</td>
                                        <td>
                                            <button type="button"
                                                    class="btn-modificar"
                                                    data-id="{{ r['id'] }}"
                                                    data-stock="{{ r['stock_inicial'] }}"
                                                    data-entradas="{{ r['entradas'] }}"
                                                    data-salidas="{{ r['salidas'] }}"
                                                    data-total="{{ r['total'] }}">
                                                Modificar
                                            </button>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
            </section>

                <!-- MODAL MODIFICAR STOCK / ENTRADAS / SALIDAS / TOTAL -->
                <div class="modal-overlay" id="modal-inventario">
                    <div class="modal-content modal-inventario-content">
                        <button type="button" class="btn-volver-modal" id="inv-modal-cerrar">
                            Volver
                        </button>
                        <h2 class="modal-titulo">Modificar inventario</h2>

                        <div class="modal-form">
                            <div class="modal-form-row">
                                <label for="inv-stock">Stock inicial</label>
                                <input type="number" id="inv-stock" min="0">
                            </div>
                            <div class="modal-form-row">
                                <label for="inv-entradas">Entradas</label>
                                <input type="number" id="inv-entradas" min="0">
                            </div>
                            <div class="modal-form-row">
                                <label for="inv-salidas">Salidas</label>
                                <input type="number" id="inv-salidas" min="0">
                            </div>
                            <div class="modal-form-row">
                                <label for="inv-total">Total</label>
                                <input type="number" id="inv-total">
                            </div>

                            <div class="modal-form-actions">
                                <button type="button"
                                        class="modal-btn modal-btn-si"
                                        id="inv-modal-confirmar">
                                    Confirmar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MODAL AGREGAR INSUMO -->
                <div class="modal-overlay" id="modal-insumo">
                    <div class="modal-content modal-inventario-content">
                        <button type="button" class="btn-volver-modal" id="insumo-modal-cerrar">
                            Volver
                        </button>
                        <h2 class="modal-titulo">Agregar insumo</h2>

                        <div class="modal-form">
                            <div class="modal-form-row">
                                <label for="ins-codigo">Código</label>
                                <input type="text" id="ins-codigo">
                            </div>
                            <div class="modal-form-row">
                                <label for="ins-nombre">Insumo</label>
                                <input type="text" id="ins-nombre">
                            </div>
                            <div class="modal-form-row">
                                <label for="ins-descripcion">Descripción</label>
                                <input type="text" id="ins-descripcion">
                            </div>
                            <div class="modal-form-row">
                                <label for="ins-unidad">Unidad (opcional)</label>
                                <input type="text" id="ins-unidad">
                            </div>
                            <div class="modal-form-row">
                                <label for="ins-stock">Stock inicial</label>
                                <input type="number" id="ins-stock" min="0" value="0">
                            </div>

                            <div class="modal-form-actions">
                                <button type="button"
                                        class="modal-btn modal-btn-si"
                                        id="insumo-modal-confirmar">
                                    Confirmar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                    <!-- MODAL ELIMINAR INSUMO -->
                    <div class="modal-overlay" id="modal-insumo-eliminar">
                        <div class="modal-content modal-inventario-content">
                           <button type="button"
                                    class="btn-volver-modal"
                                    id="del-insumo-cerrar"
                                    onclick="
                                        document.getElementById('modal-insumo-eliminar').style.display='none';
                                        document.getElementById('btn-eliminar-insumo-header').style.visibility='visible';
                                    ">
                                Volver
                            </button>

                            <h2 class="modal-titulo">Eliminar insumo</h2>

                            <div class="modal-form">
                                <div class="modal-form-row">
                                    <label for="del-insumo-select">Seleccionar insumo</label>
                                    <select id="del-insumo-select">
                                        <option value="">-- Seleccione un insumo --</option>
                                        {% for r in registros %}
                                            <option value="{{ r['codigo'] }}">
                                                {{ r['codigo'] }} - {{ r['nombre'] }} {{ r['descripcion'] }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                  <div class="modal-form-actions">
                                        <button type="button"
                                                class="modal-btn modal-btn-no"
                                                id="del-insumo-eliminar">
                                            Eliminar
                                        </button>
                                    </div>
                            </div>
                        </div>          
                    </div>

                    <!-- MODAL CONFIRMACIÓN ELIMINAR INSUMO -->
                    <div class="modal-overlay" id="modal-insumo-confirm">
                        <div class="modal-content">
                            <p class="modal-texto">¿ESTÁS SEGURO QUE QUERÉS ELIMINAR ESTE INSUMO?</p>
                            <div class="modal-botones">
                                <button type="button" class="modal-btn modal-btn-si" id="insumo-conf-si">SI</button>
                                <button type="button" class="modal-btn modal-btn-no" id="insumo-conf-no">NO</button>
                            </div>
                        </div>
                    </div>



                    <!-- MODAL MODIFICAR INSUMO -->
                        <div class="modal-overlay" id="modal-insumo-editar">
                            <div class="modal-content modal-inventario-content">
                                <button type="button" class="btn-volver-modal" id="edit-insumo-cerrar">
                                    Volver
                                </button>
                                <h2 class="modal-titulo">Modificar insumo</h2>

                                <div class="modal-form">
                                    <div class="modal-form-row">
                                        <label for="edit-insumo-select">Seleccionar insumo</label>
                                        <select id="edit-insumo-select">
                                            {% for r in registros %}
                                                <option value="{{ r['codigo'] }}"
                                                        data-nombre="{{ r['nombre'] }}"
                                                        data-descripcion="{{ r['descripcion'] }}"
                                                        data-unidad="{{ r['unidad'] or '' }}">
                                                    {{ r['codigo'] }} - {{ r['nombre'] }} {{ r['descripcion'] }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="modal-form-row">
                                        <label for="edit-codigo">Código</label>
                                        <input type="text" id="edit-codigo">
                                    </div>
                                    <div class="modal-form-row">
                                        <label for="edit-nombre">Insumo</label>
                                        <input type="text" id="edit-nombre">
                                    </div>
                                    <div class="modal-form-row">
                                        <label for="edit-descripcion">Descripción</label>
                                        <input type="text" id="edit-descripcion">
                                    </div>
                                    <div class="modal-form-row">
                                        <label for="edit-unidad">Unidad (opcional)</label>
                                        <input type="text" id="edit-unidad">
                                    </div>

                                    <div class="modal-form-actions">
                                        <button type="button"
                                                class="modal-btn modal-btn-si"
                                                id="edit-insumo-confirmar">
                                            Confirmar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                {% elif vista == "inventario_simple" %}
            <section class="historial">
                <h1 class="historial-titulo">Inventario</h1>

                <div class="historial-filtro inventario-filtro">
                    <label for="filtro-inventario-simple">Filtrar:</label>
                    <input id="filtro-inventario-simple" type="text"
                           placeholder="Escriba para filtrar">
                </div>

                <div class="historial-tabla-wrapper">
                    <table class="historial-tabla" id="tabla-inventario-simple">
                        <thead>
                            <tr>
                                <th>CÓDIGO</th>
                                <th>INSUMO</th>
                                <th>DESCRIPCIÓN</th>
                                <th>STOCK INICIAL</th>
                                <th>ENTRADAS</th>
                                <th>SALIDAS</th>
                                <th>TOTAL</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in registros %}
                                <tr>
                                    <td>{{ r['codigo'] }}</td>
                                    <td>{{ r['nombre'] }}</td>
                                    <td>{{ r['descripcion'] }}</td>
                                    <td>{{ r['stock_inicial'] }}</td>
                                    <td>{{ r['entradas'] }}</td>
                                    <td>{{ r['salidas'] }}</td>
                                    <td>{{ r['total'] }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

        {% elif vista == "login_admin" %}
            <section class="login-section">
                <h1 class="welcome-title">Iniciar Sesión</h1>

                <form class="login-form" method="post" action="{{ url_for('inventario') }}">
                    <div class="login-row">
                        <label for="login-usuario">Usuario</label>
                        <input type="text"
                               id="login-usuario"
                               name="usuario"
                               autocomplete="username">
                    </div>

                    <div class="login-row">
                        <label for="login-contrasena">Contraseña</label>
                        <input type="password"
                               id="login-contrasena"
                               name="contrasena"
                               autocomplete="current-password">
                    </div>

                    {% if login_error %}
                        <p class="login-error">Usuario o contraseña incorrecta</p>
                    {% endif %}

                    <div class="login-actions">
                        <button type="submit" class="login-button">INGRESAR</button>
                    </div>
                </form>
            </section>

        
        {# ENTRADAS #}
        {% elif vista == "entradas" %}
            <section class="acciones">
                <div class="acciones-container">
                    <a href="{{ url_for('entradas_historial') }}" class="accion-card">
                        Ver historial de entradas
                    </a>
                    <a href="{{ url_for('entradas_nueva') }}" class="accion-card">
                        Registrar nueva entrada
                    </a>
                </div>
            </section>

        {# SALIDAS #}
        {% elif vista == "salidas" %}
            <section class="acciones">
                <div class="acciones-container">
                    <a href="{{ url_for('salidas_historial') }}" class="accion-card">
                        Ver historial de salidas
                    </a>
                    <a href="{{ url_for('salidas_nueva') }}" class="accion-card">
                        Registrar nueva salida
                    </a>
                </div>
            </section>


        {# PEDIDOS - menú con tarjetas #}
        {% elif vista == "pedidos" %}
            <section class="acciones">
                <div class="acciones-container">
                    <a href="{{ url_for('pedidos_historial') }}" class="accion-card">
                        Ver historial de pedidos
                    </a>
                    <a href="{{ url_for('pedidos_nuevo') }}" class="accion-card">
                        Registrar nuevo pedido
                    </a>
                </div>
            </section>

        {# REGISTRAR NUEVA ENTRADA #}
        {% elif vista == "entradas_nueva" %}
            <section class="form-registro">
                <h1 class="form-titulo">Registrar nueva entrada</h1>
                <form class="form-container" method="post" id="form-entrada-nueva">
                    <div class="form-row">
                      <div class="form-card">
                        <p id="error-insumo" class="error-msg"></p>
                        <label for="insumo_seleccionado">Seleccionar insumo</label>
                        <select id="insumo_seleccionado"
                                name="insumo_seleccionado"
                                class="select-insumo"
                                data-img-base="{{ url_for('static', filename='img/insumos/') }}">
                            <option value="">-- Seleccionar insumo --</option>
                            {% for i in insumos %}
                                <option
                                    value="{{ i['codigo'] }}"
                                    data-nombre="{{ i['nombre_mostrar'] }}"
                                    data-descripcion="{{ i['descripcion'] }}"
                                >
                                    {{ i['nombre_mostrar'] }}
                                </option>
                            {% endfor %}
                        </select>

                        <img id="insumo-imagen"
                            class="insumo-imagen"
                            src=""
                            alt="Imagen del insumo seleccionado">
                    </div>

                        <div class="form-card">
                            <p id="error-unidad" class="error-msg"></p>
                            <label for="unidad_seleccionada">Seleccionar unidad</label>
                            <select id="unidad_seleccionada" name="unidad_seleccionada" class="select-unidad">
                                <option value="">-- Seleccionar unidad --</option>
                                {% for n in range(1, 21) %}
                                    <option value="{{ n }}">{{ n }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <button type="button" class="confirm-button" id="btn-entrada-confirmar">
                        Confirmar registro
                    </button>
                </form>

                <!-- MODAL VISTA PREVIA ENTRADA -->
                <div class="modal-overlay" id="modal-entrada-previa">
                    <div class="modal-content modal-previa">
                        <h2 class="modal-titulo">Vista previa del registro</h2>

                        <div class="historial-tabla-wrapper">
                            <table class="historial-tabla">
                                <thead>
                                    <tr>
                                        <th>FECHA</th>
                                        <th>CÓDIGO</th>
                                        <th>INSUMO</th>
                                        <th>DESCRIPCIÓN</th>
                                        <th>CANTIDAD</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td id="prev-entrada-fecha"></td>
                                        <td id="prev-entrada-codigo"></td>
                                        <td id="prev-entrada-insumo"></td>
                                        <td id="prev-entrada-descripcion"></td>
                                        <td id="prev-entrada-cantidad"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="modal-form-actions">
                            <button type="button"
                                    class="modal-btn modal-btn-no"
                                    id="entrada-previa-cancelar">
                                Volver
                            </button>

                            <button type="submit"
                                    class="modal-btn modal-btn-si modal-btn-azul"
                                    form="form-entrada-nueva"
                                    id="entrada-finalizar">
                                Finalizar registro
                            </button>
                        </div>
                    </div>
                </div>

                <div id="modal-ok" class="modal-overlay"
                    data-activo="{{ '1' if registro_ok else '0' }}">
                    <div class="modal-content">
                        <p class="modal-texto">¡Registro confirmado!</p>
                    </div>
                </div>

            </section>

        {# REGISTRAR NUEVA SALIDA #}
        {% elif vista == "salidas_nueva" %}
            <section class="form-registro">
                <h1 class="form-titulo">Registrar nueva salida</h1>
                <form class="form-container" method="post" id="form-salida-nueva">
                    <div class="form-row">
                        <div class="form-card">
                            <p id="error-insumo" class="error-msg"></p>
                            <label for="insumo_seleccionado">Seleccionar insumo</label>
                            <select id="insumo_seleccionado"
                                    name="insumo_seleccionado"
                                    class="select-insumo"
                                    data-img-base="{{ url_for('static', filename='img/insumos/') }}">
                                <option value="">-- Seleccionar insumo --</option>
                                {% for i in insumos %}
                                    <option
                                        value="{{ i['codigo'] }}"
                                        data-nombre="{{ i['nombre_mostrar'] }}"
                                        data-descripcion="{{ i['descripcion'] }}"
                                    >
                                        {{ i['nombre_mostrar'] }}
                                    </option>
                                {% endfor %}
                            </select>

                            <img id="insumo-imagen"
                                class="insumo-imagen"
                                src=""
                                alt="Imagen del insumo seleccionado">
                        </div>

                        <div class="form-card">
                            <p id="error-unidad" class="error-msg"></p>
                            <label for="unidad_seleccionada">Seleccionar unidad</label>
                            <select id="unidad_seleccionada" name="unidad_seleccionada" class="select-unidad">
                                <option value="">-- Seleccionar unidad --</option>
                                {% for n in range(1, 21) %}
                                    <option value="{{ n }}">{{ n }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <button type="button" class="confirm-button" id="btn-salida-confirmar">
                        Confirmar registro
                    </button>
                </form>

                <!-- MODAL VISTA PREVIA SALIDA -->
                <div class="modal-overlay" id="modal-salida-previa">
                    <div class="modal-content modal-previa">
                        <h2 class="modal-titulo">Vista previa del registro</h2>

                        <div class="historial-tabla-wrapper">
                            <table class="historial-tabla">
                                <thead>
                                    <tr>
                                        <th>FECHA</th>
                                        <th>CÓDIGO</th>
                                        <th>INSUMO</th>
                                        <th>DESCRIPCIÓN</th>
                                        <th>CANTIDAD</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td id="prev-salida-fecha"></td>
                                        <td id="prev-salida-codigo"></td>
                                        <td id="prev-salida-insumo"></td>
                                        <td id="prev-salida-descripcion"></td>
                                        <td id="prev-salida-cantidad"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="modal-form-actions">
                            <button type="button"
                                    class="modal-btn modal-btn-no"
                                    id="salida-previa-cancelar">
                                Volver
                            </button>

                            <button type="submit"
                                    class="modal-btn modal-btn-si modal-btn-azul"
                                    form="form-salida-nueva"
                                    id="salida-finalizar">
                                Finalizar registro
                            </button>
                        </div>
                    </div>
                </div>

                <div id="modal-ok" class="modal-overlay"
                    data-activo="{{ '1' if registro_ok else '0' }}">
                    <div class="modal-content">
                        <p class="modal-texto">¡Registro confirmado!</p>
                    </div>
                </div>

            </section>

        {# HISTORIAL DE ENTRADAS #}
        {% elif vista == "entradas_historial" %}
            <section class="historial">
                <h1 class="historial-titulo">Historial de entradas</h1>

                <div class="historial-filtro">
                    <label for="filtro-historial">Filtrar:</label>
                    <input id="filtro-historial" type="text"
                        placeholder="Escriba para filtrar (código, insumo, descripción...)">
                </div>

                <div class="historial-tabla-wrapper">
                    <table class="historial-tabla" id="tabla-historial" data-tipo="entrada">
                        <thead>
                            <tr>
                                <th>FECHA</th>
                                <th>CÓDIGO</th>
                                <th>INSUMO</th>
                                <th>DESCRIPCIÓN</th>
                                <th>CANTIDAD</th>
                                <th>ACCIÓN</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in registros %}
                                <tr data-row-id="{{ r['id'] }}">
                                    <td>{{ r['fecha'] }}</td>
                                    <td>{{ r['codigo'] }}</td>
                                    <td>{{ r['nombre'] }}</td>
                                    <td>{{ r['descripcion'] }}</td>
                                    <td>{{ r['cantidad'] }}</td>
                                    <td>
                                        <button type="button"
                                                class="btn-borrar"
                                                data-id="{{ r['id'] }}"
                                                data-tipo="entrada">
                                            Borrar
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>

        {# HISTORIAL DE SALIDAS #}
        {% elif vista == "salidas_historial" %}
            <section class="historial">
                <h1 class="historial-titulo">Historial de salidas</h1>

                <div class="historial-filtro">
                    <label for="filtro-historial">Filtrar:</label>
                    <input id="filtro-historial" type="text"
                        placeholder="Escriba para filtrar (código, insumo, descripción...)">
                </div>

                <div class="historial-tabla-wrapper">
                    <table class="historial-tabla" id="tabla-historial" data-tipo="salida">
                        <thead>
                            <tr>
                                <th>FECHA</th>
                                <th>CÓDIGO</th>
                                <th>INSUMO</th>
                                <th>DESCRIPCIÓN</th>
                                <th>CANTIDAD</th>
                                <th>ACCIÓN</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in registros %}
                                <tr data-row-id="{{ r['id'] }}">
                                    <td>{{ r['fecha'] }}</td>
                                    <td>{{ r['codigo'] }}</td>
                                    <td>{{ r['nombre'] }}</td>
                                    <td>{{ r['descripcion'] }}</td>
                                    <td>{{ r['cantidad'] }}</td>
                                    <td>
                                        <button type="button"
                                                class="btn-borrar"
                                                data-id="{{ r['id'] }}"
                                                data-tipo="salida">
                                            Borrar
                                        </button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>


        {# REGISTRAR NUEVO PEDIDO (por ahora placeholder) #}
        {% elif vista == "pedidos" %}
            <section class="menu-secundario">
                <h1 class="welcome-title">Pedidos</h1>
                <div class="menu-secundario-opciones">
                    <div class="menu-card"
                         onclick="window.location='{{ url_for('pedidos_historial') }}'">
                        Ver historial de pedidos
                    </div>
                    <div class="menu-card"
                         onclick="window.location='{{ url_for('pedidos_nuevo') }}'">
                        Registrar nuevo pedido
                    </div>
                </div>
            </section>

        {% elif vista == "pedidos_nuevo" %}
            <section class="registro-section">
                <h1 class="welcome-title">Registrar nuevo pedido</h1>

                <form id="form-pedido-nuevo" method="post" action="{{ url_for('pedidos_nuevo') }}">
                    <div class="registro-cards-grid">
                        <div class="registro-card">
                            <label for="pedido_por">Pedido por</label>
                            <input type="text" id="pedido_por" name="pedido_por">
                            <p class="campo-error" id="err-pedido_por"></p>
                        </div>

                        <div class="registro-card">
                            <label for="proveedor">Proveedor</label>
                            <input type="text" id="proveedor" name="proveedor">
                            <p class="campo-error" id="err-proveedor"></p>
                        </div>

                        <div class="registro-card">
                            <label for="insumo_pedido">Insumo</label>
                            <input type="text"
                                id="insumo_pedido"
                                name="insumo"
                                list="lista-insumos-pedido">
                            <datalist id="lista-insumos-pedido">
                                {% for i in insumos %}
                                    <option value="{{ i['nombre'] }} {{ i['descripcion'] }}"
                                            data-codigo="{{ i['codigo'] }}"></option>
                                {% endfor %}
                            </datalist>
                            <!-- campo oculto donde guardamos el código si coincide con inventario -->
                            <input type="hidden" id="insumo_codigo" name="insumo_codigo">
                            <p class="campo-error" id="err-insumo_pedido"></p>
                        </div>


                        <div class="registro-card">
                            <label for="presentacion">Presentación</label>
                            <input type="text" id="presentacion" name="presentacion">
                            <p class="campo-error" id="err-presentacion"></p>
                        </div>

                        <div class="registro-card">
                            <label for="descripcion_pedido">Descripción</label>
                            <input type="text" id="descripcion_pedido" name="descripcion">
                            <p class="campo-error" id="err-descripcion_pedido"></p>
                        </div>

                        <div class="registro-card">
                            <label for="cantidad_pedido">Cantidad</label>
                            <input type="number" id="cantidad_pedido" name="cantidad" min="1">
                            <p class="campo-error" id="err-cantidad_pedido"></p>
                        </div>
                    </div>

                    <!-- Botón Confirmar registro (mismo estilo que entradas/salidas) -->
                    <div class="registro-acciones">
                        <button type="button"
                                id="btn-pedido-confirmar"
                                class="btn-confirmar">
                            Confirmar registro
                        </button>
                    </div>
                </form>

                <!-- MODAL VISTA PREVIA PEDIDO -->
                <div class="modal-overlay" id="modal-pedido-previa">
                    <div class="modal-content modal-previa">
                        <h2 class="modal-titulo">Vista previa del pedido</h2>

                        <div class="historial-tabla-wrapper">
                            <table class="historial-tabla">
                                <thead>
                                    <tr>
                                        <th>FECHA</th>
                                        <th>PEDIDO POR</th>
                                        <th>PROVEEDOR</th>
                                        <th>INSUMO</th>
                                        <th>PRESENTACIÓN</th>
                                        <th>DESCRIPCIÓN</th>
                                        <th>CANTIDAD</th>
                                        <th>ESTADO</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td id="prev-pedido-fecha"></td>
                                        <td id="prev-pedido-por"></td>
                                        <td id="prev-pedido-proveedor"></td>
                                        <td id="prev-pedido-insumo"></td>
                                        <td id="prev-pedido-presentacion"></td>
                                        <td id="prev-pedido-descripcion"></td>
                                        <td id="prev-pedido-cantidad"></td>
                                        <td id="prev-pedido-estado">En Espera</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="modal-form-actions">
                            <button type="button"
                                    class="modal-btn modal-btn-no"
                                    id="pedido-previa-cancelar">
                                Volver
                            </button>

                            <!-- Azul, finaliza registro -->
                            <button type="submit"
                                    class="modal-btn modal-btn-si modal-btn-azul"
                                    form="form-pedido-nuevo"
                                    id="pedido-finalizar">
                                Finalizar registro
                            </button>
                        </div>
                    </div>
                </div>
            </section>

        {% elif vista == "pedidos_historial" %}
                <section class="historial">
                    <div class="historial-header">
                        <div class="historial-header-left">
                            <h1 class="historial-titulo">Historial de pedidos</h1>
                            <div class="historial-filtro">
                                <label for="filtro-pedidos">Filtrar:</label>
                                <input id="filtro-pedidos" type="text" placeholder="Escriba para filtrar">
                            </div>
                        </div>
                    </div>

                    <div class="historial-tabla-wrapper">
                        <table class="historial-tabla" id="tabla-pedidos">
                            <thead>
                                <tr>
                                    <th>FECHA</th>
                                    <th>PEDIDO POR</th>
                                    <th>PROVEEDOR</th>
                                    <th>INSUMO</th>
                                    <th>PRESENTACIÓN</th>
                                    <th>DESCRIPCIÓN</th>
                                    <th>CANTIDAD</th>
                                    <th>ESTADO</th>
                                    <th>ACCIÓN</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in registros %}
                                    <tr class="{% if p['estado'] == 'Entregado' %}pedido-entregado{% endif %}">
                                        <td>{{ p['fecha'] }}</td>
                                        <td>{{ p['pedido_por'] }}</td>
                                        <td>{{ p['proveedor'] }}</td>
                                        <td>{{ p['insumo'] }}</td>
                                        <td>{{ p['presentacion'] }}</td>
                                        <td>{{ p['descripcion'] }}</td>
                                        <td>{{ p['cantidad'] }}</td>
                                        <td>{{ p['estado'] }}</td>
                                        <td>
                                            {% if p['estado'] != 'Entregado' %}
                                                <form method="post"
                                                    action="{{ url_for('pedido_entregado', pedido_id=p['id']) }}">
                                                    <button type="submit" class="btn-entregado">
                                                        Entregado
                                                    </button>
                                                </form>
                                            {% else %}
                                                <!-- Ya entregado, podés mostrar un ✔ o dejar vacío -->
                                                <span class="pedido-entregado-icono">✔</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </section>

        {% endif %}

        <!-- MODAL BORRADO (Global - para entradas, salidas y pedidos) -->
        <div class="modal-overlay" id="modal-borrar">
            <div class="modal-content">
                <p class="modal-texto">¿Seguro que quieres borrar?</p>
                <div class="modal-botones">
                    <button type="button" class="modal-btn modal-btn-si">SI</button>
                    <button type="button" class="modal-btn modal-btn-no">NO</button>
                </div>
            </div>
        </div>
    </main>

    <!-- LOGO FIJO -->
    <img src="{{ url_for('static', filename='img/logo-nextprint.png') }}"
         alt="Nextprint"
         class="logo-fixed">

    <!-- JS -->
    <script src="{{ url_for('static', filename='main.js') }}"></script>

</body>
</html>
